sudo: false
dist: trusty

language: node_js
node_js:
  - 'node'

cache:
  yarn: true
  directories:
    - node_modules
    - ~/.cache

before_install:
  - npm i -g yarn codecov

install:
  - yarn install --frozen-lockfile
  - yarn cypress install

before_script:
  - git fetch --unshallow

script:
  - yarn build
  - yarn build-zip
  - yarn test:e2e:ci
  - test -f dist/manifest.json
  - test -f dist/background.js
  - test -f dist/vendor.js
  - test -f dist/vendor.css
  - test -f dist/popup/popup.js
  - test -f dist/popup/popup.css
  - test -f dist/options/options.js
  - test -f dist/options/options.css
  - test -f "dist-zip/Solary-v$(node -pe "require('./package.json').version").zip"
